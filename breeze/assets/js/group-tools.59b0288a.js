"use strict";(self["webpackChunkbreeze"]=self["webpackChunkbreeze"]||[]).push([[769],{95077:function(e,t,a){a.r(t),a.d(t,{default:function(){return L}});var s=a(82234);function l(e,t,a,l,o,i){const r=(0,s.resolveComponent)("Tables"),n=(0,s.resolveComponent)("el-tab-pane"),c=(0,s.resolveComponent)("Medias"),d=(0,s.resolveComponent)("el-tabs");return(0,s.openBlock)(),(0,s.createBlock)(d,{modelValue:o.currentTab,"onUpdate:modelValue":t[0]||(t[0]=e=>o.currentTab=e),type:"card","tab-position":"left",stretch:""},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(n,{label:e.$t("tables"),name:"tables"},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(),(0,s.createBlock)(r,{key:o.currentTab+"A"}))])),_:1},8,["label"]),(0,s.createVNode)(n,{label:e.$t("medias"),name:"medias"},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(),(0,s.createBlock)(c,{key:o.currentTab+"B"}))])),_:1},8,["label"])])),_:1},8,["modelValue"])}var o=a(31567),i=a(38855);const r={class:"text-left"},n={class:"text-right"},c={style:{"text-align":"center","margin-top":"20px",display:"flex"}},d={class:"dialog-footer"};function h(e,t,a,l,o,i){const h=(0,s.resolveComponent)("el-col"),u=(0,s.resolveComponent)("el-button"),p=(0,s.resolveComponent)("el-row"),m=(0,s.resolveComponent)("el-table-column"),g=(0,s.resolveComponent)("el-input"),b=(0,s.resolveComponent)("el-table"),f=(0,s.resolveComponent)("el-pagination"),w=(0,s.resolveComponent)("el-card"),C=(0,s.resolveComponent)("el-option"),x=(0,s.resolveComponent)("el-select"),V=(0,s.resolveComponent)("el-form"),$=(0,s.resolveComponent)("el-dialog"),v=(0,s.resolveDirective)("loading");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createVNode)(w,{shadow:"hover"},{header:(0,s.withCtx)((()=>[(0,s.createVNode)(p,{align:"middle"},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(h,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",r,[(0,s.createElementVNode)("h3",null,(0,s.toDisplayString)(e.$t("mediasBackup")),1)])])),_:1}),(0,s.createVNode)(h,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",n,[(0,s.createVNode)(u,{size:"default",type:"primary",icon:"plus",onClick:t[0]||(t[0]=e=>i.addItem())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("createBackup")),1)])),_:1})])])),_:1})])),_:1})])),default:(0,s.withCtx)((()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(b,{data:i.pagedTableData,"empty-text":e.$t("noData"),border:"",stripe:"","header-cell-class-name":"el-table-header",style:{width:"100%"}},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(m,{type:"index",index:i.indexMethod,fixed:"",width:"50"},null,8,["index"]),(0,s.createVNode)(m,{sortable:"",label:e.$t("backupDate"),fixed:"",width:"200"},{default:(0,s.withCtx)((t=>[(0,s.createTextVNode)((0,s.toDisplayString)(i.reformatDate(t.row.insert_datetime,{inPattern:"YYYY-MM-DD HH:mm:ss",outPattern:e.dateFormat+" - HH:mm",locale:e.$i18n.locale})),1)])),_:1},8,["label"]),(0,s.createVNode)(m,{sortable:"",label:e.$t("code"),prop:"code",width:"150","show-overflow-tooltip":""},null,8,["label"]),(0,s.createVNode)(m,{sortable:"",label:e.$t("mediasDate"),width:"200"},{default:(0,s.withCtx)((t=>[(0,s.createTextVNode)((0,s.toDisplayString)(t.row.medias_date?t.row.medias_date:e.$t("all2")),1)])),_:1},8,["label"]),(0,s.createVNode)(m,{align:"right",width:"250",fixed:"right"},{header:(0,s.withCtx)((()=>[(0,s.createVNode)(g,{modelValue:o.search,"onUpdate:modelValue":t[1]||(t[1]=e=>o.search=e),size:"small",placeholder:e.$t("search")},null,8,["modelValue","placeholder"])])),default:(0,s.withCtx)((t=>[(0,s.createVNode)(p,{gutter:10},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(h,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(u,{size:"small",type:"success",icon:"download",style:{width:"100%"},onClick:e=>i.downloadFile(t.$index,t.row)},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("download")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.createVNode)(h,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(u,{size:"small",type:"danger",icon:"delete",style:{width:"100%"},onClick:e=>i.deleteItem(t.$index,t.row)},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:1})])),_:1},8,["data","empty-text"])),[[v,o.isLoading]]),(0,s.createElementVNode)("div",c,[(0,s.createVNode)(f,{background:"",style:{margin:"0 auto"},layout:"prev, pager, next","hide-on-single-page":!0,"page-size":o.pageSize,total:o.total,onCurrentChange:i.setPage},null,8,["page-size","total","onCurrentChange"])])])),_:1}),(0,s.createVNode)($,{modelValue:o.dialog,"onUpdate:modelValue":t[5]||(t[5]=e=>o.dialog=e),title:e.$t("createMediasBackup"),width:"30%"},{footer:(0,s.withCtx)((()=>[(0,s.createElementVNode)("span",d,[(0,s.createVNode)(u,{onClick:t[3]||(t[3]=e=>i.cancelForm())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("cancel")),1)])),_:1}),(0,s.createVNode)(u,{type:"primary",onClick:t[4]||(t[4]=e=>i.submitForm())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("confirm")),1)])),_:1})])])),default:(0,s.withCtx)((()=>[(0,s.createVNode)(V,{ref:"form",rules:o.rules,model:o.formData,"label-width":"150px","label-position":"left","hide-required-asterisk":""},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(x,{modelValue:o.formData.mediasDate,"onUpdate:modelValue":t[2]||(t[2]=e=>o.formData.mediasDate=e),style:{width:"100%"}},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(C,{label:e.$t("allDates"),value:""},null,8,["label"]),((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(i.dates,(e=>((0,s.openBlock)(),(0,s.createBlock)(C,{key:e.id,value:e.id,label:e.label},null,8,["value","label"])))),128))])),_:1},8,["modelValue"])])),_:1},8,["rules","model"])])),_:1},8,["modelValue","title"])],64)}a(57658);var u=a(39355),p=a(11165),m=a(92829),g=a(98761),b=a(64713),f=a(21101),w={name:"Medias",mixins:[i.Z,o.Z,g.Z],data(){return{medias:[],formData:{mediasDate:""},rules:{mediasDate:[{required:!0,message:this.$t("fieldRequired"),trigger:"blur"}]},isLoading:!1,dialog:!1,tableData:[],pageSize:6,search:"",total:0,page:1}},computed:{pagedTableData(){return this.total=this.searching.length,this.searching.slice(this.pageSize*this.page-this.pageSize,this.pageSize*this.page)},searching(){return this.search?(this.page=1,this.tableData.filter((e=>e.code.toLowerCase().includes(this.search.toLowerCase())||e.medias_date.toLowerCase().includes(this.search.toLowerCase())))):(this.total=this.tableData.length,this.tableData)},dates(){const e=[];return this.medias.forEach((t=>{const a=this.extractDateFormats(t.insert_datetime);a&&-1==e.findIndex((e=>this.$_.isEqual(e,a)))&&e.push(a)})),e}},created(){this.init()},methods:{reformatDate:u.bK,...(0,f.mapActions)("data",["getMediasBackups","makeMediasBackup","deleteMediasBackup"]),setPage(e){this.page=e},indexMethod(e){return e+(this.page-1)*this.pageSize+1},extractDateFormats(e){if(!e)return"";let t=(0,u.bK)(e.split(" ")[0],{outPattern:"DD MMMM YYYY",locale:this.$i18n.locale});return t=t.split(" "),{id:e.split(" ")[0],label:(0,m.fm)(t[1])+" "+t[2]}},async init(){this.isLoading=!0;const e=await this.getAllItemsFromDB({context:b.R});e.success&&e.data&&(this.medias=e.data);const t=await this.getMediasBackups();t.success?t.data&&(this.tableData=t.data):this.$message.error(this.$t("anErrorOccured")),this.isLoading=!1},addItem(){this.formData.mediasDate="",this.dialog=!0},downloadFile(e,t){(0,m.w4)(p.APP_BASE_URL+"/breeze-server/backups/"+t.code+".zip")},deleteItem(e,t){this.$confirm(this.$t("deleteBackupQuestion"),this.$t("delete"),{confirmButtonText:this.$t("yes"),cancelButtonText:this.$t("cancel"),type:"warning"}).then((async()=>{const e=await this.deleteMediasBackup(t.id);e.success?(this.$message.success(this.$t("success")),this.init()):this.$message.error(this.$t("anErrorOccured"))})).catch((()=>{}))},submitForm(){this.$refs.form.validate((async e=>{if(!e)return!1;{const e=this.$message({message:this.$t("pleaseWait"),duration:0}),t=await this.makeMediasBackup({code:this.$uuidv4(),medias_date:this.formData.mediasDate});e.close(),t.success?this.$message.success(this.$t("success")):this.$message.error(this.$t("anErrorOccured")),this.cancelForm(),this.init()}}))},cancelForm(){this.$refs.form.resetFields(),this.dialog=!1}}},C=a(83744);const x=(0,C.Z)(w,[["render",h]]);var V=x;const $={class:"text-left"},v={class:"text-right"},D={style:{"text-align":"center","margin-top":"20px",display:"flex"}},N={class:"dialog-footer"};function k(e,t,a,l,o,i){const r=(0,s.resolveComponent)("el-col"),n=(0,s.resolveComponent)("el-button"),c=(0,s.resolveComponent)("el-row"),d=(0,s.resolveComponent)("el-table-column"),h=(0,s.resolveComponent)("el-input"),u=(0,s.resolveComponent)("el-table"),p=(0,s.resolveComponent)("el-pagination"),m=(0,s.resolveComponent)("el-card"),g=(0,s.resolveComponent)("el-option"),b=(0,s.resolveComponent)("el-select"),f=(0,s.resolveComponent)("el-form-item"),w=(0,s.resolveComponent)("el-form"),C=(0,s.resolveComponent)("el-dialog"),x=(0,s.resolveDirective)("loading");return(0,s.openBlock)(),(0,s.createElementBlock)(s.Fragment,null,[(0,s.createVNode)(m,{shadow:"hover"},{header:(0,s.withCtx)((()=>[(0,s.createVNode)(c,{align:"middle"},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(r,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",$,[(0,s.createElementVNode)("h3",null,(0,s.toDisplayString)(e.$t("tablesBackup")),1)])])),_:1}),(0,s.createVNode)(r,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",v,[(0,s.createVNode)(n,{size:"default",type:"primary",icon:"plus",onClick:t[0]||(t[0]=e=>i.addItem())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("createBackup")),1)])),_:1})])])),_:1})])),_:1})])),default:(0,s.withCtx)((()=>[(0,s.withDirectives)(((0,s.openBlock)(),(0,s.createBlock)(u,{data:i.pagedTableData,"empty-text":e.$t("noData"),border:"",stripe:"","header-cell-class-name":"el-table-header",style:{width:"100%"}},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(d,{type:"index",index:i.indexMethod},null,8,["index"]),(0,s.createVNode)(d,{sortable:"",label:e.$t("date"),width:"160"},{default:(0,s.withCtx)((t=>[(0,s.createTextVNode)((0,s.toDisplayString)(i.reformatDate(t.row.insert_datetime,{inPattern:"YYYY-MM-DD HH:mm:ss",outPattern:e.dateFormat+" - HH:mm",locale:e.$i18n.locale})),1)])),_:1},8,["label"]),(0,s.createVNode)(d,{sortable:"",label:e.$t("code"),prop:"code","show-overflow-tooltip":""},null,8,["label"]),(0,s.createVNode)(d,{sortable:"",label:e.$t("tables"),prop:"tables"},{default:(0,s.withCtx)((e=>[(0,s.createTextVNode)((0,s.toDisplayString)(i.showTables(e.row.tables)),1)])),_:1},8,["label"]),(0,s.createVNode)(d,{align:"right",width:"250",fixed:"right"},{header:(0,s.withCtx)((()=>[(0,s.createVNode)(h,{modelValue:o.search,"onUpdate:modelValue":t[1]||(t[1]=e=>o.search=e),size:"small",placeholder:e.$t("search")},null,8,["modelValue","placeholder"])])),default:(0,s.withCtx)((t=>[(0,s.createVNode)(c,{gutter:10},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(r,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(n,{size:"small",type:"success",icon:"download",style:{width:"100%"},onClick:e=>i.downloadFile(t.$index,t.row)},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("download")),1)])),_:2},1032,["onClick"])])),_:2},1024),(0,s.createVNode)(r,{span:12},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(n,{size:"small",type:"danger",icon:"delete",style:{width:"100%"},onClick:e=>i.deleteItem(t.$index,t.row)},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("delete")),1)])),_:2},1032,["onClick"])])),_:2},1024)])),_:2},1024)])),_:1})])),_:1},8,["data","empty-text"])),[[x,o.isLoading]]),(0,s.createElementVNode)("div",D,[(0,s.createVNode)(p,{background:"",style:{margin:"0 auto"},layout:"prev, pager, next","hide-on-single-page":!0,"page-size":o.pageSize,total:o.total,onCurrentChange:i.setPage},null,8,["page-size","total","onCurrentChange"])])])),_:1}),(0,s.createVNode)(C,{modelValue:o.tbDialog,"onUpdate:modelValue":t[6]||(t[6]=e=>o.tbDialog=e),title:e.$t("createTablesBackup"),width:"40%",onClose:t[7]||(t[7]=e=>i.updateTableItemsInactivity())},{footer:(0,s.withCtx)((()=>[(0,s.createElementVNode)("span",N,[(0,s.createVNode)(n,{onClick:t[4]||(t[4]=e=>i.cancelForm())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("cancel")),1)])),_:1}),(0,s.createVNode)(n,{type:"primary",onClick:t[5]||(t[5]=e=>i.submitForm())},{default:(0,s.withCtx)((()=>[(0,s.createTextVNode)((0,s.toDisplayString)(e.$t("confirm")),1)])),_:1})])])),default:(0,s.withCtx)((()=>[(0,s.createVNode)(w,{ref:"createTb",model:o.tb,rules:o.rules,"label-width":"150px","label-position":"left","hide-required-asterisk":""},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(f,{prop:"tables",label:e.$t("tables")},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(b,{modelValue:o.tb.tables,"onUpdate:modelValue":t[2]||(t[2]=e=>o.tb.tables=e),multiple:"",filterable:"",placeholder:e.$t("select"),"no-data-text":e.$t("noData"),"no-match-text":e.$t("noMatchingData"),style:{width:"100%"},onChange:t[3]||(t[3]=e=>i.updateTableItemsInactivity())},{default:(0,s.withCtx)((()=>[((0,s.openBlock)(!0),(0,s.createElementBlock)(s.Fragment,null,(0,s.renderList)(o.tablesList,(t=>((0,s.openBlock)(),(0,s.createBlock)(g,{key:t.value,value:t.value,label:t["label_"+e.$i18n.locale],disabled:!!t.inactive},null,8,["value","label","disabled"])))),128))])),_:1},8,["modelValue","placeholder","no-data-text","no-match-text"])])),_:1},8,["label"])])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"])],64)}var y={name:"TablesBackup",mixins:[i.Z,o.Z,g.Z],data(){return{tablesList:[],tb:{tables:[]},rules:{tables:[{required:!0,message:this.$t("fieldRequired"),trigger:"blur"}]},isLoading:!1,tbDialog:!1,tableData:[],pageSize:6,search:"",total:0,page:1}},computed:{pagedTableData(){return this.total=this.searching.length,this.searching.slice(this.pageSize*this.page-this.pageSize,this.pageSize*this.page)},searching(){return this.search?(this.page=1,this.tableData.filter((e=>e.code.toLowerCase().includes(this.search.toLowerCase())||e.insert_datetime.toLowerCase().includes(this.search.toLowerCase())))):(this.total=this.tableData.length,this.tableData)}},created(){this.init()},methods:{reformatDate:u.bK,...(0,f.mapActions)("data",["getTablesList","getTablesBackups","makeTablesBackup","deleteTablesBackup"]),setPage(e){this.page=e},indexMethod(e){return e+(this.page-1)*this.pageSize+1},updateTableItemsInactivity(){this.tablesList.forEach(((e,t)=>{this.tb.tables.length?this.tablesList[t].inactive="*"===e.value?!this.tb.tables.includes("*"):this.tb.tables.includes("*"):this.tablesList[t].inactive=!1}))},showTables(e){if(e){let t="";const a=e.split(";");for(let e=0;e<a.length;e++){const s=this.tablesList.find((t=>t.value==a[e]));s&&(t+=s["label_"+this.$i18n.locale],e+1<a.length&&(t+=" / "))}return t}return""},async init(){this.isLoading=!0;const e=await this.getTablesList();e.success&&e.data&&(this.tablesList=e.data);const t=await this.getTablesBackups();t.success?t.data&&(this.tableData=t.data):this.$message.error(this.$t("anErrorOccured")),this.isLoading=!1},addItem(){this.tb.tables=[],this.tbDialog=!0},downloadFile(e,t){(0,m.w4)(p.APP_BASE_URL+"/breeze-server/backups/"+t.code+".sql")},deleteItem(e,t){this.$confirm(this.$t("deleteBackupQuestion"),this.$t("delete"),{confirmButtonText:this.$t("yes"),cancelButtonText:this.$t("cancel"),type:"warning"}).then((async()=>{const e=await this.deleteTablesBackup(t.id);e.success?(this.$message.success(this.$t("success")),this.init()):this.$message.error(this.$t("anErrorOccured"))})).catch((()=>{}))},submitForm(){this.$refs.createTb.validate((async e=>{if(!e)return!1;{const e=this.$message({message:this.$t("pleaseWait"),duration:0}),t=await this.makeTablesBackup({code:this.$uuidv4(),tables:this.tb.tables.join(";")});e.close(),t.success?this.$message.success(this.$t("success")):this.$message.error(this.$t("anErrorOccured")),this.cancelForm(),this.init()}}))},cancelForm(){this.$refs.createTb.resetFields(),this.tbDialog=!1}}};const S=(0,C.Z)(y,[["render",k]]);var _=S,B={name:"Backups",components:{Tables:_,Medias:V},mixins:[i.Z,o.Z],data(){return{currentTab:"tables"}}};const T=(0,C.Z)(B,[["render",l],["__scopeId","data-v-fbdd333c"]]);var L=T},29251:function(e,t,a){a.r(t),a.d(t,{default:function(){return c}});var s=a(82234);const l={class:"img-container"};function o(e,t,a,o,i,r){const n=(0,s.resolveComponent)("font-awesome-icon"),c=(0,s.resolveComponent)("el-empty"),d=(0,s.resolveComponent)("el-card");return(0,s.openBlock)(),(0,s.createBlock)(d,{shadow:"hover"},{default:(0,s.withCtx)((()=>[(0,s.createVNode)(c,null,{image:(0,s.withCtx)((()=>[(0,s.createElementVNode)("div",l,[(0,s.createVNode)(n,{size:"10x",icon:"chart-bar",style:{color:"silver",position:"absolute",top:"0",left:"0"}}),(0,s.createVNode)(n,{size:"5x",icon:"chart-pie",style:{color:"var(--primary-color)",position:"absolute",top:"-50",right:"0"}})])])),description:(0,s.withCtx)((()=>[(0,s.createElementVNode)("small",null,[(0,s.createElementVNode)("b",null,(0,s.toDisplayString)(e.$t("noStatisticsForTheMoment")),1)])])),_:1})])),_:1})}var i={name:"Stats"},r=a(83744);const n=(0,r.Z)(i,[["render",o],["__scopeId","data-v-1dfe8a48"]]);var c=n},31567:function(e,t,a){var s=a(14340),l=a(21101);t["Z"]={created(){const e=-1===this.restrictedScopes.findIndex((e=>this.$route.name.includes(e.value)));e||this.$router.replace(s.Z5.LOGIN.PATH)},computed:{...(0,l.mapState)({userData:e=>e.session.userData,accessList:e=>e.access.accessList}),...(0,l.mapGetters)({userScopes:"access/getUserScopes",restrictedScopes:"access/getUserRestrictedScopes",disabledModuleScopes:"access/getDisabledModuleScopes",userPageScopes:"access/getUserPageScopes",userActionScopes:"access/getUserActionScopes",userSectionScopes:"access/getUserSectionScopes",userPageScope:"access/getUserPageScope",userActionScope:"access/getUserActionScope",userSectionScope:"access/getUserSectionScope"})},methods:{...(0,l.mapActions)("access",["getAllAccess"]),getAccessName(e){const t=this.accessList.find((t=>t.id==e));return t?t.name:""}}}},38855:function(e,t,a){a(57658);var s=a(39355),l=a(14340),o=a(20747),i=a(21101);t["Z"]={data(){return{Routes:l.Z5,Currencies:l.Kt,WebsiteInfo:l.a,currencies:[]}},async created(){this.$_.forIn(l.Kt,((e,t)=>{this.currencies.push(e)})),this.$store.commit("global/updateCurrentPanelPath",this.$route.path,{root:!0});const e=await this.getItemFromDB({context:o.A,id:this.userData?.id});e.success&&e.data&&e.data.status==l.dp.DISABLED&&(this.destroySession(),this.$router.replace(l.Z5.LOGIN.PATH))},computed:{...(0,i.mapState)({userData:e=>e.session.userData}),...(0,i.mapGetters)({isUserConnected:"session/isUserConnected",getSettingValue:"setting/getSettingValue"})},methods:{formatDate:s.p6,reformatDate:s.bK,...(0,i.mapMutations)({destroySession:"session/destroySession"})}}}}]);
//# sourceMappingURL=group-tools.59b0288a.js.map